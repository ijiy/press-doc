import{_ as s,c as n,o as a,a1 as l}from"./chunks/framework.B3EJgH_4.js";const d=JSON.parse('{"title":"Midway","description":"","frontmatter":{},"headers":[],"relativePath":"project/server/midway/index.md","filePath":"project/server/midway/index.md","lastUpdated":1715407916000}'),p={name:"project/server/midway/index.md"},e=l(`<h1 id="midway" tabindex="-1">Midway <a class="header-anchor" href="#midway" aria-label="Permalink to &quot;Midway&quot;">â€‹</a></h1><h2 id="ç¯å¢ƒ" tabindex="-1">ç¯å¢ƒ <a class="header-anchor" href="#ç¯å¢ƒ" aria-label="Permalink to &quot;ç¯å¢ƒ&quot;">â€‹</a></h2><ul><li><p><code>node -v</code> -&gt; <code>v16.14.2</code></p></li><li><p><code>pnpm -v</code> -&gt; <code>6.32.3</code></p></li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">npm</span><span style="color:#E6DB74;"> i</span><span style="color:#E6DB74;"> pnpm</span><span style="color:#AE81FF;"> -g</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># lint -&gt; build å¯åŠ¨</span></span>
<span class="line"><span style="color:#A6E22E;">pm2</span><span style="color:#E6DB74;"> start</span><span style="color:#E6DB74;"> ./bootstrap.js</span><span style="color:#AE81FF;"> --name</span><span style="color:#E6DB74;"> midway_app</span><span style="color:#AE81FF;"> -i</span><span style="color:#AE81FF;"> 4</span></span>
<span class="line"><span style="color:#88846F;">## \`-i 4\` å¼€å¯4ä¸ªè¿›ç¨‹, å»æ‰å°±åªæœ‰1ä¸ªè¿›ç¨‹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># åˆ é™¤</span></span>
<span class="line"><span style="color:#A6E22E;">pm2</span><span style="color:#E6DB74;"> delete</span><span style="color:#E6DB74;"> midway_app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># åœæ­¢</span></span>
<span class="line"><span style="color:#A6E22E;">pm2</span><span style="color:#E6DB74;"> stop</span><span style="color:#E6DB74;"> midway_app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># åˆ—è¡¨</span></span>
<span class="line"><span style="color:#A6E22E;">pm2</span><span style="color:#E6DB74;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¿é—®</span></span>
<span class="line"><span style="color:#A6E22E;">http://localhost:7001</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="å®‰è£…" tabindex="-1">å®‰è£… <a class="header-anchor" href="#å®‰è£…" aria-label="Permalink to &quot;å®‰è£…&quot;">â€‹</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#88846F;"># åˆå§‹åŒ–</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> init</span><span style="color:#E6DB74;"> midway</span></span>
<span class="line"><span style="color:#88846F;">## egg-v3 - A web application boilerplate with midway v3(egg)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># å®‰è£…</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> i</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">##</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> add</span><span style="color:#E6DB74;"> pm2</span><span style="color:#AE81FF;"> -g</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è¿è¡Œ</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> run</span><span style="color:#E6DB74;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># è®¿é—®</span></span>
<span class="line"><span style="color:#A6E22E;">http://localhost:7001</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># éƒ¨ç½²</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> start</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> stop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æ£€æµ‹</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> run</span><span style="color:#E6DB74;"> lint</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># æµ‹è¯•</span></span>
<span class="line"><span style="color:#A6E22E;">pnpm</span><span style="color:#E6DB74;"> test</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="æ³¨æ„" tabindex="-1">æ³¨æ„ <a class="header-anchor" href="#æ³¨æ„" aria-label="Permalink to &quot;æ³¨æ„&quot;">â€‹</a></h2><ul><li>ä¿®æ”¹ç«¯å£ <ul><li>package.json</li></ul></li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">&quot;scripts&quot;</span><span style="color:#66D9EF;">:</span><span style="color:#E6DB74;"> {</span></span>
<span class="line"><span style="color:#A6E22E;">	&quot;dev&quot;</span><span style="color:#66D9EF;">:</span><span style="color:#E6DB74;"> &quot; --port=7001&quot;,</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>å¯èƒ½çš„æ¢è¡Œç¬¦é—®é¢˜ <ul><li>git</li></ul></li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">git</span><span style="color:#E6DB74;"> config</span><span style="color:#AE81FF;"> --global</span><span style="color:#E6DB74;"> core.autocrlf</span><span style="color:#AE81FF;"> false</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>ç¼–è¯‘ <ul><li>è¦æ±‚é›†æˆ ts, vue çš„ IDE, å¦‚ webstorm</li></ul></li></ul><h2 id="ç›®å½•" tabindex="-1">ç›®å½• <a class="header-anchor" href="#ç›®å½•" aria-label="Permalink to &quot;ç›®å½•&quot;">â€‹</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#A6E22E;">â”œâ”€â”€</span><span style="color:#E6DB74;"> src</span></span>
<span class="line"><span style="color:#A6E22E;">â”‚</span><span style="color:#E6DB74;">   â””â”€â”€</span><span style="color:#E6DB74;"> controller</span></span>
<span class="line"><span style="color:#A6E22E;">â”‚</span><span style="color:#E6DB74;">       â””â”€â”€</span><span style="color:#E6DB74;"> home.controller.ts</span></span>
<span class="line"><span style="color:#A6E22E;">â””â”€â”€</span><span style="color:#E6DB74;"> tsconfig.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>controller, æ§åˆ¶å™¨, æ–‡ä»¶åå’Œå‡½æ•°å, æ²¡æœ‰å¼•ç”¨å…³è”, ä½œç”¨: <ul><li>æ•°æ® <ul><li>ä»æ•°æ®åº“ / å…¶å®ƒæœåŠ¡å™¨ä¸­, è¿”å›æŸ¥æ‰¾çš„å†…å®¹</li><li>å°†æäº¤çš„å†…å®¹, æ›´æ–°åˆ°æ•°æ®åº“ä¸­</li></ul></li><li>è·¯ç”± <ul><li>æ ¹æ®è®¿é—®çš„åœ°å€, è¿”å›å¯¹åº”çš„ é¡µé¢ / æ¥å£</li></ul></li></ul></li></ul><h2 id="åŸºç¡€" tabindex="-1">åŸºç¡€ <a class="header-anchor" href="#åŸºç¡€" aria-label="Permalink to &quot;åŸºç¡€&quot;">â€‹</a></h2><ul><li>controller å¤„ç†çš„æ•°æ®, å¯ä»¥ä» è£…é¥°å™¨ / api ä¸­è·å– <ul><li>è£…é¥°çš„<code>&lt;Class&gt;</code>ä¼šåœ¨è¿›ç¨‹åŠ è½½ä¸­è¢«å®ä¾‹åŒ–, ä¸”ä»…æœ‰ä¸€æ¬¡</li><li>è£…é¥°å™¨ (æ ‡è¯†ä¸‹ä¸€æ¡è¯­å¥ç±»å‹) <ul><li><code>@Controller(&#39;/&#39;);</code> Webæ§åˆ¶å™¨<code>&lt;Class&gt;</code>, å‚æ•° (æŒ‡å‘è®¿é—®çš„é¡µé¢åœ°å€ / æ¥å£åœ°å€), åŒ…å«<code>@Provide</code>, ä¸éœ€é‡å¤æš´éœ²</li><li><code>@Provide();</code> æš´éœ²ä¾èµ–<code>&lt;Class&gt;</code>, å‚æ•°(è¡¨ç¤º_id)</li><li><code>@Inject();</code> æ³¨å…¥ä¾èµ–, å‚æ•°(è¡¨ç¤º_id)</li><li><code>@Query(&#39;id&#39;);</code> è¿”å›å¯¹åº”å‚æ•° (?id=1), <code>@Query()</code> è¿”å›åŒ…å«æ‰€æœ‰å‚æ•°çš„å¯¹è±¡</li></ul></li><li>api <ul><li><code>this.ctx.request.body;</code></li><li><code>this.ctx.response.body</code>, ç®€å†™æˆ <code>this.ctx.body</code></li><li><code>this.ctx.query;</code></li><li><code>this.ctx.get(&#39;cache-control&#39;);</code></li></ul></li></ul></li></ul><p>åé¢ç»Ÿä¸€ä¼˜å…ˆä½¿ç”¨<code>è£…é¥°å™¨</code></p><h3 id="è·¯ç”±" tabindex="-1">è·¯ç”± <a class="header-anchor" href="#è·¯ç”±" aria-label="Permalink to &quot;è·¯ç”±&quot;">â€‹</a></h3><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#88846F;">// src/controller/home.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Configuration, Controller, Inject, Get, Post } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;@midwayjs/decorator&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> { Context } </span><span style="color:#F92672;">from</span><span style="color:#E6DB74;"> &#39;egg&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// HomeController å‡½æ•°, æä¾›ç»™è·¯ç”± &#39;/&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">Controller</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// å¿½ç•¥è·¯ç”±å‰ç¼€</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">Controller</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/api&#39;</span><span style="color:#F8F8F2;">, {ignoreGlobalPrefix: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// å¯¼å…¥ç»„ä»¶</span></span>
<span class="line"><span style="color:#F8F8F2;">@</span><span style="color:#A6E22E;">Configuration</span><span style="color:#F8F8F2;">({</span></span>
<span class="line"><span style="color:#F8F8F2;">  imports: [</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">      component: info,</span></span>
<span class="line"><span style="color:#F8F8F2;">      enabledEnvironment: [</span><span style="color:#E6DB74;">&#39;local&#39;</span><span style="color:#F8F8F2;">],</span></span>
<span class="line"><span style="color:#F8F8F2;">    },</span></span>
<span class="line"><span style="color:#F8F8F2;">  ],</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#66D9EF;font-style:italic;"> class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">HomeController</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">	// Get, Post, Put, Del, Patch, Options, Head, All</span></span>
<span class="line"><span style="color:#88846F;">	// home æ–¹æ³•, åªèƒ½é€šè¿‡ Get è¯·æ±‚, æä¾›ç»™è·¯ç”± &#39;/&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">	@</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">	@</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/main&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">	@</span><span style="color:#A6E22E;">ContentType</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;html&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F92672;">	async</span><span style="color:#A6E22E;"> home</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F92672;">		return</span><span style="color:#E6DB74;"> &#39;&lt;body&gt;hello world&lt;/body&gt;&#39;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">	@</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F92672;">	async</span><span style="color:#A6E22E;"> getUser</span><span style="color:#F8F8F2;">(@</span><span style="color:#A6E22E;">Query</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;id&#39;</span><span style="color:#F8F8F2;">) </span><span style="color:#FD971F;font-style:italic;">id</span><span style="color:#F92672;">:</span><span style="color:#66D9EF;font-style:italic;"> string</span><span style="color:#F8F8F2;">)</span><span style="color:#F92672;">:</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Promise</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">User</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#88846F;">		// xxxx</span></span>
<span class="line"><span style="color:#F8F8F2;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">	// æ³¨å…¥ä¸Šä¸‹æ–‡, å¯¹åº” @Provide(); æš´éœ²å‡½æ•°</span></span>
<span class="line"><span style="color:#F8F8F2;">	@</span><span style="color:#A6E22E;">Inject</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#88846F;">	// å®šä¹‰ ctx æŒ‡å‘ import çš„å‡½æ•°; åœ¨å‡½æ•°ä¸­é€šè¿‡ this.ctx è®¿é—®ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="color:#88846F;">	// ç›¸å½“äº const ctx = new Context();</span></span>
<span class="line"><span style="color:#F8F8F2;">	ctx</span><span style="color:#F92672;">:</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Context</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">	@</span><span style="color:#A6E22E;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;/&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F92672;">	async</span><span style="color:#A6E22E;"> getUser</span><span style="color:#F8F8F2;">()</span><span style="color:#F92672;">:</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Promise</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#A6E22E;text-decoration:underline;">User</span><span style="color:#F8F8F2;">&gt; {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">		const</span><span style="color:#F8F8F2;"> query </span><span style="color:#F92672;">=</span><span style="color:#FD971F;"> this</span><span style="color:#F8F8F2;">.ctx.query;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">		// set cookie</span></span>
<span class="line"><span style="color:#FD971F;">	    this</span><span style="color:#F8F8F2;">.ctx.cookies.</span><span style="color:#A6E22E;">set</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;bar&#39;</span><span style="color:#F8F8F2;">, { encrypt: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> });</span></span>
<span class="line"><span style="color:#88846F;">	    // get cookie</span></span>
<span class="line"><span style="color:#FD971F;">	    this</span><span style="color:#F8F8F2;">.ctx.cookies.</span><span style="color:#A6E22E;">get</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;foo&#39;</span><span style="color:#F8F8F2;">, { encrypt: </span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;"> });</span></span>
<span class="line"><span style="color:#F8F8F2;">	}</span></span>
<span class="line"><span style="color:#F8F8F2;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h2 id="æ–‡çŒ®-ğŸ¨" tabindex="-1">æ–‡çŒ® ğŸ¨ <a class="header-anchor" href="#æ–‡çŒ®-ğŸ¨" aria-label="Permalink to &quot;æ–‡çŒ® ğŸ¨&quot;">â€‹</a></h2><ul><li><a href="http://www.midwayjs.org/docs/intro" target="_blank" rel="noreferrer">æ–‡æ¡£</a></li></ul>`,22),o=[e];function r(c,t,i,F,b,y){return a(),n("div",null,o)}const m=s(p,[["render",r]]);export{d as __pageData,m as default};
