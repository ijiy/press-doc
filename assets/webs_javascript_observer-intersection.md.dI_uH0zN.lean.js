import{_ as n,c as a,a0 as l,o as p}from"./chunks/framework.Bakaa70P.js";const b=JSON.parse('{"title":"JS IntersectionObserver 【元素可视侦听器】","description":"","frontmatter":{},"headers":[],"relativePath":"webs/javascript/observer-intersection.md","filePath":"webs/javascript/observer-intersection.md","lastUpdated":1721206549000}'),t={name:"webs/javascript/observer-intersection.md"};function e(o,s,c,r,F,i){return p(),a("div",null,s[0]||(s[0]=[l(`<h1 id="js-intersectionobserver-【元素可视侦听器】" tabindex="-1">JS IntersectionObserver 【元素可视侦听器】 <a class="header-anchor" href="#js-intersectionobserver-【元素可视侦听器】" aria-label="Permalink to &quot;JS IntersectionObserver 【元素可视侦听器】&quot;">​</a></h1><ul><li><p>侦听元素是否在浏览器的可视区域</p></li><li><p>示例</p><ul><li>定位滚动到哪个元素 (代替<code>onscroll</code>)</li></ul></li></ul><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki monokai vp-code" tabindex="0"><code><span class="line"><span style="color:#F8F8F2;">&lt;!</span><span style="color:#F92672;">DOCTYPE</span><span style="color:#A6E22E;"> html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;</span><span style="color:#F92672;">meta</span><span style="color:#A6E22E;"> charset</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;utf-8&quot;</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;&lt;/</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;</span><span style="color:#F92672;">style</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F92672;">		body</span><span style="color:#F8F8F2;">, </span><span style="color:#F92672;">ul</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">			margin</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">		}</span></span>
<span class="line"><span style="color:#F92672;">		ul</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">			padding</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">		}</span></span>
<span class="line"><span style="color:#F92672;">		li</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">			list-style</span><span style="color:#F8F8F2;">: </span><span style="color:#66D9EF;">none</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">			height</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">500</span><span style="color:#F92672;">px</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">		}</span></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;/</span><span style="color:#F92672;">style</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;</span><span style="color:#F92672;">ul</span><span style="color:#A6E22E;"> id</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;id_ul&quot;</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">		&lt;</span><span style="color:#F92672;">li</span><span style="color:#A6E22E;"> style</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;background: red;&quot;</span><span style="color:#A6E22E;"> data-id</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;1&quot;</span><span style="color:#F8F8F2;">&gt;1&lt;/</span><span style="color:#F92672;">li</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">		&lt;</span><span style="color:#F92672;">li</span><span style="color:#A6E22E;"> style</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;background: blue;&quot;</span><span style="color:#A6E22E;"> data-id</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;2&quot;</span><span style="color:#F8F8F2;">&gt;2&lt;/</span><span style="color:#F92672;">li</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">		&lt;</span><span style="color:#F92672;">li</span><span style="color:#A6E22E;"> style</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;background: green;&quot;</span><span style="color:#A6E22E;"> data-id</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;3&quot;</span><span style="color:#F8F8F2;">&gt;3&lt;/</span><span style="color:#F92672;">li</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">		&lt;</span><span style="color:#F92672;">li</span><span style="color:#A6E22E;"> style</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;background: yellow;&quot;</span><span style="color:#A6E22E;"> data-id</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;4&quot;</span><span style="color:#F8F8F2;">&gt;4&lt;/</span><span style="color:#F92672;">li</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">		&lt;</span><span style="color:#F92672;">li</span><span style="color:#A6E22E;"> style</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;background: purple;&quot;</span><span style="color:#A6E22E;"> data-id</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;5&quot;</span><span style="color:#F8F8F2;">&gt;5&lt;/</span><span style="color:#F92672;">li</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;/</span><span style="color:#F92672;">ul</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;</span><span style="color:#F92672;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#88846F;">		/**</span></span>
<span class="line"><span style="color:#88846F;">		 * 侦听dom的显示状态变化</span></span>
<span class="line"><span style="color:#88846F;">		 */</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">		class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">UseObserver</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">			/**</span></span>
<span class="line"><span style="color:#88846F;">			 * 初始化侦听器</span></span>
<span class="line"><span style="color:#88846F;">			 * </span><span style="color:#66D9EF;font-style:italic;">@param</span><span style="color:#F8F8F2;"> callback</span><span style="color:#88846F;"> 回调函数 (list: 当前显示的data-id集合) =&gt; {}</span></span>
<span class="line"><span style="color:#88846F;">			 */</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">			constructor</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">callback</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">				let</span><span style="color:#F8F8F2;"> cId;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">				let</span><span style="color:#F8F8F2;"> cIndex;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">				const</span><span style="color:#F8F8F2;"> cList </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FD971F;">				this</span><span style="color:#F8F8F2;">.obs </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> IntersectionObserver</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">entries</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">					entries.</span><span style="color:#A6E22E;">forEach</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">item</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">						cId </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> item.target.</span><span style="color:#A6E22E;">getAttribute</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;data-id&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">						cIndex </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> cList.</span><span style="color:#A6E22E;">indexOf</span><span style="color:#F8F8F2;">(cId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">						if</span><span style="color:#F8F8F2;"> (item.isIntersecting) {</span></span>
<span class="line"><span style="color:#F8F8F2;">							cIndex </span><span style="color:#F92672;">===</span><span style="color:#F92672;"> -</span><span style="color:#AE81FF;">1</span><span style="color:#F92672;"> &amp;&amp;</span><span style="color:#F8F8F2;"> cList.</span><span style="color:#A6E22E;">push</span><span style="color:#F8F8F2;">(cId);</span></span>
<span class="line"><span style="color:#F8F8F2;">						} </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">							cIndex </span><span style="color:#F92672;">&gt;</span><span style="color:#F92672;"> -</span><span style="color:#AE81FF;">1</span><span style="color:#F92672;"> &amp;&amp;</span><span style="color:#F8F8F2;"> cList.</span><span style="color:#A6E22E;">splice</span><span style="color:#F8F8F2;">(cIndex, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">						}</span></span>
<span class="line"><span style="color:#F8F8F2;">					});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6E22E;">					callback</span><span style="color:#F8F8F2;">(cList);</span></span>
<span class="line"><span style="color:#F8F8F2;">				});</span></span>
<span class="line"><span style="color:#F8F8F2;">			}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">			/**</span></span>
<span class="line"><span style="color:#88846F;">			 * 添加被侦听的DOM元素</span></span>
<span class="line"><span style="color:#88846F;">			 * </span><span style="color:#66D9EF;font-style:italic;">@desc</span><span style="color:#88846F;"> 元素上需要绑定属性\`data-id\`, 值可以数据\`id\`, 或遍历的索引\`index\`</span></span>
<span class="line"><span style="color:#88846F;">			 */</span></span>
<span class="line"><span style="color:#A6E22E;">			add</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">dom</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">				this</span><span style="color:#F8F8F2;">.obs.</span><span style="color:#A6E22E;">observe</span><span style="color:#F8F8F2;">(dom);</span></span>
<span class="line"><span style="color:#F8F8F2;">			}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">			/**</span></span>
<span class="line"><span style="color:#88846F;">			 * 停止侦听</span></span>
<span class="line"><span style="color:#88846F;">			 */</span></span>
<span class="line"><span style="color:#A6E22E;">			stop</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#FD971F;">				this</span><span style="color:#F8F8F2;">.obs.</span><span style="color:#A6E22E;">disconnect</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">			}</span></span>
<span class="line"><span style="color:#F8F8F2;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">		// 使用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">		// 所有访问过的可视dom的data-id集合</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">		let</span><span style="color:#F8F8F2;"> visibled </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [];</span></span>
<span class="line"><span style="color:#88846F;">		// 实例化侦听器</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">		const</span><span style="color:#F8F8F2;"> myObserver </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> UseObserver</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">list</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">			visibled </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> visibled.</span><span style="color:#A6E22E;">concat</span><span style="color:#F8F8F2;">(list).</span><span style="color:#A6E22E;">filter</span><span style="color:#F8F8F2;">((</span><span style="color:#FD971F;font-style:italic;">item</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">index</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">self</span><span style="color:#F8F8F2;">) </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> self.</span><span style="color:#A6E22E;">indexOf</span><span style="color:#F8F8F2;">(item) </span><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> index);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">			console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;当前显示的 data-id =&gt; &#39;</span><span style="color:#F8F8F2;">, list, </span><span style="color:#E6DB74;">&#39;; 所有访问过的 data-id =&gt; &#39;</span><span style="color:#F8F8F2;">, visibled);</span></span>
<span class="line"><span style="color:#F8F8F2;">		});</span></span>
<span class="line"><span style="color:#88846F;">		// 添加侦听对象</span></span>
<span class="line"><span style="color:#F8F8F2;">		id_ul.</span><span style="color:#A6E22E;">querySelectorAll</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&#39;li&#39;</span><span style="color:#F8F8F2;">).</span><span style="color:#A6E22E;">forEach</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">item</span><span style="color:#66D9EF;font-style:italic;"> =&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">			myObserver.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(item);</span></span>
<span class="line"><span style="color:#F8F8F2;">		});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">		// 进阶使用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">		// 动态添加dom</span></span>
<span class="line"><span style="color:#A6E22E;">		setTimeout</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">			const</span><span style="color:#F8F8F2;"> newLi </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> id_ul.children.</span><span style="color:#A6E22E;">item</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">).</span><span style="color:#A6E22E;">cloneNode</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">true</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">			id_ul.</span><span style="color:#A6E22E;">appendChild</span><span style="color:#F8F8F2;">(newLi);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">			myObserver.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(newLi);</span></span>
<span class="line"><span style="color:#F8F8F2;">		}, </span><span style="color:#AE81FF;">3e3</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">		// 在适当的地方停止侦听</span></span>
<span class="line"><span style="color:#A6E22E;">		setTimeout</span><span style="color:#F8F8F2;">(() </span><span style="color:#66D9EF;font-style:italic;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">			myObserver.</span><span style="color:#A6E22E;">stop</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">		}, </span><span style="color:#AE81FF;">6e3</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">	&lt;/</span><span style="color:#F92672;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div>`,3)]))}const u=n(t,[["render",e]]);export{b as __pageData,u as default};
